{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\micha\\\\Projets\\\\masterpiece\\\\frontend\\\\src\\\\Message\\\\MessageContainer.jsx\";\nimport React, { Component, Fragment, createRef } from \"react\";\nimport { connect } from \"react-redux\";\nimport MessageList from \"./MessageList\";\nimport AddMessage from \"./AddMessage\";\nimport SockJsClient from 'react-stomp';\nimport { addMessage, getMessageList } from \"./messageActions\";\nimport listServerErrors from \"../global/functions/listServerErrors\";\nimport { openNotification } from \"../Notification/notificationActions\";\nimport { withRouter } from \"react-router-dom\";\n\nclass MessageContainer extends Component {\n  constructor() {\n    super();\n    this.sockJsClient = createRef();\n  }\n\n  componentDidMount() {\n    // Get room's messages\n    this.props.getMessageList(this.props.roomId);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.roomId !== this.props.roomId) {\n      this.props.getMessageList(this.props.roomId);\n    }\n  }\n\n  handleMessage(response, topic) {\n    const body = response.body,\n          statusCode = response.statusCode,\n          statusCodeValue = response.statusCodeValue; // Message received with success\n\n    if (statusCode === \"OK\" && body !== null) {\n      this.props.addMessage(body.username, body.message);\n    } // Show success notif if message sent with success\n\n\n    if (topic === \"/user/queue/success\") {\n      this.props.openNotification(\"Message envoyé\", \"success\");\n    } // Show error notif if message sending failed\n\n\n    if (topic === \"/user/queue/errors\") {\n      const errorsMsg = listServerErrors(statusCodeValue, body);\n      this.props.openNotification(errorsMsg, \"error\");\n    }\n  }\n\n  render() {\n    return React.createElement(Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 49\n      },\n      __self: this\n    }, React.createElement(MessageList, {\n      messages: this.props.messages,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 50\n      },\n      __self: this\n    }), React.createElement(AddMessage, {\n      username: this.props.username,\n      roomId: this.props.roomId,\n      sockJsClient: this.sockJsClient.current,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51\n      },\n      __self: this\n    }), React.createElement(SockJsClient, {\n      url: \"http://localhost:8081/websocket-chat/\",\n      topics: ['/topic/user', \"/user/queue/errors\", \"/user/queue/success\"],\n      onConnect: () => {\n        console.log(\"connected\");\n      },\n      onDisconnect: () => {\n        console.log(\"Disconnected\");\n      },\n      onMessage: (response, topic) => this.handleMessage(response, topic),\n      ref: this.sockJsClient,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = state => ({\n  messages: state.messages,\n  roomId: state.singleRoom.id\n});\n\nconst mapDispatchToProps = dispatch => ({\n  getMessageList: roomId => dispatch(getMessageList(roomId)),\n  addMessage: (username, message) => dispatch(addMessage(username, message)),\n  openNotification: (messages, severity) => dispatch(openNotification(messages, severity))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(MessageContainer));","map":{"version":3,"sources":["C:/Users/micha/Projets/masterpiece/frontend/src/Message/MessageContainer.jsx"],"names":["React","Component","Fragment","createRef","connect","MessageList","AddMessage","SockJsClient","addMessage","getMessageList","listServerErrors","openNotification","withRouter","MessageContainer","constructor","sockJsClient","componentDidMount","props","roomId","componentDidUpdate","prevProps","handleMessage","response","topic","body","statusCode","statusCodeValue","username","message","errorsMsg","render","messages","current","console","log","mapStateToProps","state","singleRoom","id","mapDispatchToProps","dispatch","severity"],"mappings":"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","sourcesContent":["import React, { Component, Fragment, createRef } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport MessageList from \"./MessageList\";\r\nimport AddMessage from \"./AddMessage\";\r\nimport SockJsClient from 'react-stomp';\r\nimport { addMessage, getMessageList } from \"./messageActions\";\r\nimport listServerErrors from \"../global/functions/listServerErrors\";\r\nimport { openNotification } from \"../Notification/notificationActions\";\r\nimport { withRouter } from \"react-router-dom\";\r\n\r\nclass MessageContainer extends Component {\r\n\r\n    constructor() {\r\n        super();\r\n        this.sockJsClient = createRef();\r\n    }\r\n\r\n    componentDidMount() {\r\n        // Get room's messages\r\n        this.props.getMessageList(this.props.roomId);\r\n    }\r\n\r\n    componentDidUpdate(prevProps) {\r\n        if (prevProps.roomId !== this.props.roomId) {\r\n            this.props.getMessageList(this.props.roomId);\r\n        }\r\n    }\r\n\r\n    handleMessage(response, topic) {\r\n        const { body, statusCode, statusCodeValue } = response;\r\n\r\n        // Message received with success\r\n        if (statusCode === \"OK\" && body !== null) {\r\n            this.props.addMessage(body.username, body.message);\r\n        }\r\n        // Show success notif if message sent with success\r\n        if (topic === \"/user/queue/success\") {\r\n            this.props.openNotification(\"Message envoyé\", \"success\");\r\n        }\r\n        // Show error notif if message sending failed\r\n        if(topic === \"/user/queue/errors\") {\r\n            const errorsMsg = listServerErrors(statusCodeValue, body)\r\n            this.props.openNotification(errorsMsg, \"error\")\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Fragment>\r\n                <MessageList messages={this.props.messages} />\r\n                <AddMessage username={this.props.username} roomId={this.props.roomId} sockJsClient={this.sockJsClient.current} />\r\n                <SockJsClient\r\n                    url='http://localhost:8081/websocket-chat/'\r\n                    topics={['/topic/user', \"/user/queue/errors\", \"/user/queue/success\"]}\r\n                    onConnect={() => {\r\n                        console.log(\"connected\");\r\n                    }}\r\n                    onDisconnect={() => {\r\n                        console.log(\"Disconnected\");\r\n                    }}\r\n                    onMessage={(response, topic) => this.handleMessage(response, topic)}\r\n                    ref={this.sockJsClient}\r\n                />\r\n            </Fragment>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => ({\r\n    messages: state.messages,\r\n    roomId: state.singleRoom.id\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n    getMessageList: (roomId) => dispatch(getMessageList(roomId)),\r\n    addMessage: (username, message) => dispatch(addMessage(username, message)),\r\n    openNotification: (messages, severity) => dispatch(openNotification(messages, severity))\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(MessageContainer));"]},"metadata":{},"sourceType":"module"}